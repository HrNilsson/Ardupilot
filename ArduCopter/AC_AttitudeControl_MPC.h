#ifndef AC_ATTITUDE_MPC_H
#define AC_ATTITUDE_MPC_H

#include <AP_Math/MMath.h>
#include <AP_math/midaco.h>
#include <AP_AHRS/AP_AHRS.h>
#include <AP_Motors/AP_Motors.h>
#include <Filter/Filter.h>         // filter library
#include "stdio.h"

class AC_AttitudeControl_MPC {
public:
	AC_AttitudeControl_MPC( AP_AHRS& ahrs,
                            AP_Motors& motors) :
        _ahrs(ahrs),
        _motors(motors),
		dx1_old(0),
		dx3_old(0),
		dx5_old(0)
       /* dx1_filter(),
		dx3_filter(),
		dx5_filter()*/
    {
		_f     = ptrAlloc(3, 1, f);
		_dx    = ptrAlloc(6, 1, dx);
		_y     = ptrAlloc(6, 1, y);
		_IqTnQ = ptrAlloc(90, 6, IqTnQ);
		_IqC   = ptrAlloc(90, 3, IqC);
		_WyG   = ptrAlloc(90, 3, WyG);
		_R     = ptrAlloc(90, 1, R);
		_F     = ptrAlloc(90, 1, F);
		_temp1 = ptrAlloc(90, 1, temp1);
		_temp2 = ptrAlloc(90, 1, temp2);
		_temp3 = ptrAlloc(1, 90, temp3);
		_temp4 = ptrAlloc(1, 3, temp4);

		/*dx1_filter.set_cutoff_frequency(1.0f);
		dx1_filter.reset(0.0f);
		dx3_filter.set_cutoff_frequency(1.0f);
		dx3_filter.reset(0.0f);
		dx5_filter.set_cutoff_frequency(1.0f);
		dx5_filter.reset(0.0f);*/
    }

    virtual ~AC_AttitudeControl_MPC()
    {}

    void initMPC(); //inits midaco
	void updateState(); //updates dx and y
	void updateMatrices(double rollTarget, double pitchTarget, double yawTarget); //calculates f
	void solve(); //Invokes the midaco solver
	void outputToMotor();

	double getf1();
	double getf2();
	double getf3();
	double getx1();
	double getx2();
	double getx3();

	int convert(double d);
	const Vector3f& angle_ef_targets() const { return _angle_ef_target; }
private:
    // references to external libraries
    const AP_AHRS&      _ahrs;
    AP_Motors&          _motors;

   /* LowPassFilterDouble dx1_filter;
    LowPassFilterDouble dx3_filter;
    LowPassFilterDouble dx5_filter;*/

    // Array declarations

    double f[3][1] = {{0},{0},{0}};

    double old_x[6] = {{0},{0},{0},{0},{0},{0}};
    double dx[6][1] = { {0}, {0}, {0}, {0}, {0}, {0} };
    double y[3][1] = { {0}, {0}, {0} };

    /*
     * Wy = 10
     * Wu = 0.01
     * I: Theoretical without dynamics
     */
    /*
    double IqTnQ[90][6] = {{1,0.01,0,0,0,0},{0,0,1,0.01,0,0},{0,0,0,0,1,0.01},{2,0.03,0,0,0,0},{0,0,2,0.03,0,0},{0,0,0,0,2,0.03},{3,0.06,0,0,0,0},{0,0,3,0.06,0,0},{0,0,0,0,3,0.06},{4,0.1,0,0,0,0},{0,0,4,0.1,0,0},{0,0,0,0,4,0.1},{5,0.15,0,0,0,0},{0,0,5,0.15,0,0},{0,0,0,0,5,0.15},{6,0.21,0,0,0,0},{0,0,6,0.21,0,0},{0,0,0,0,6,0.21},{7,0.28,0,0,0,0},{0,0,7,0.28,0,0},{0,0,0,0,7,0.28},{8,0.36,0,0,0,0},{0,0,8,0.36,0,0},{0,0,0,0,8,0.36},{9,0.45,0,0,0,0},{0,0,9,0.45,0,0},{0,0,0,0,9,0.45},{10,0.55,0,0,0,0},{0,0,10,0.55,0,0},{0,0,0,0,10,0.55},{11,0.66,0,0,0,0},{0,0,11,0.66,0,0},{0,0,0,0,11,0.66},{12,0.78,0,0,0,0},{0,0,12,0.78,0,0},{0,0,0,0,12,0.78},{13,0.91,0,0,0,0},{0,0,13,0.91,0,0},{0,0,0,0,13,0.91},{14,1.05,0,0,0,0},{0,0,14,1.05,0,0},{0,0,0,0,14,1.05},{15,1.2,0,0,0,0},{0,0,15,1.2,0,0},{0,0,0,0,15,1.2},{16,1.36,0,0,0,0},{0,0,16,1.36,0,0},{0,0,0,0,16,1.36},{17,1.53,0,0,0,0},{0,0,17,1.53,0,0},{0,0,0,0,17,1.53},{18,1.71,0,0,0,0},{0,0,18,1.71,0,0},{0,0,0,0,18,1.71},{19,1.9,0,0,0,0},{0,0,19,1.9,0,0},{0,0,0,0,19,1.9},{20,2.1,0,0,0,0},{0,0,20,2.1,0,0},{0,0,0,0,20,2.1},{21,2.31,0,0,0,0},{0,0,21,2.31,0,0},{0,0,0,0,21,2.31},{22,2.53,0,0,0,0},{0,0,22,2.53,0,0},{0,0,0,0,22,2.53},{23,2.76,0,0,0,0},{0,0,23,2.76,0,0},{0,0,0,0,23,2.76},{24,3,0,0,0,0},{0,0,24,3,0,0},{0,0,0,0,24,3},{25,3.25,0,0,0,0},{0,0,25,3.25,0,0},{0,0,0,0,25,3.25},{26,3.51,0,0,0,0},{0,0,26,3.51,0,0},{0,0,0,0,26,3.51},{27,3.78,0,0,0,0},{0,0,27,3.78,0,0},{0,0,0,0,27,3.78},{28,4.06,0,0,0,0},{0,0,28,4.06,0,0},{0,0,0,0,28,4.06},{29,4.35,0,0,0,0},{0,0,29,4.35,0,0},{0,0,0,0,29,4.35},{30,4.65,0,0,0,0},{0,0,30,4.65,0,0},{0,0,0,0,30,4.65}};
    double IqC[90][3] = { {1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1}};
    double WyG[90][3] = {{0.009816,0,0},{0,0.0030904,0},{0,0,0.017197},{0.039264,0,0},{0,0.012361,0},{0,0,0.068789},{0.088344,0,0},{0,0.027813,0},{0,0,0.15478},{0.15706,0,0},{0,0.049446,0},{0,0,0.27516},{0.2454,0,0},{0,0.077259,0},{0,0,0.42993},{0.35338,0,0},{0,0.11125,0},{0,0,0.6191},{0.48098,0,0},{0,0.15143,0},{0,0,0.84267},{0.62822,0,0},{0,0.19778,0},{0,0,1.1006},{0.79509,0,0},{0,0.25032,0},{0,0,1.393},{0.9816,0,0},{0,0.30904,0},{0,0,1.7197},{1.1877,0,0},{0,0.37393,0},{0,0,2.0809},{1.4135,0,0},{0,0.44501,0},{0,0,2.4764},{1.6589,0,0},{0,0.52227,0},{0,0,2.9063},{1.9239,0,0},{0,0.60571,0},{0,0,3.3707},{2.2086,0,0},{0,0.69533,0},{0,0,3.8694},{2.5129,0,0},{0,0.79113,0},{0,0,4.4025},{2.8368,0,0},{0,0.89312,0},{0,0,4.97},{3.1804,0,0},{0,1.0013,0},{0,0,5.5719},{3.5436,0,0},{0,1.1156,0},{0,0,6.2082},{3.9264,0,0},{0,1.2361,0},{0,0,6.8789},{4.3288,0,0},{0,1.3629,0},{0,0,7.584},{4.7509,0,0},{0,1.4957,0},{0,0,8.3235},{5.1927,0,0},{0,1.6348,0},{0,0,9.0974},{5.654,0,0},{0,1.7801,0},{0,0,9.9057},{6.135,0,0},{0,1.9315,0},{0,0,10.748},{6.6356,0,0},{0,2.0891,0},{0,0,11.625},{7.1558,0,0},{0,2.2529,0},{0,0,12.537},{7.6957,0,0},{0,2.4229,0},{0,0,13.483},{8.2552,0,0},{0,2.599,0},{0,0,14.463},{8.8344,0,0},{0,2.7813,0},{0,0,15.478}};
	*/

    /*// 100 Hz not modified
    double IqTnQ[90][6] = {{1,0.01,0,0,0,0},{0,0,1,0.01,0,0},{0,0,0,0,1,0.01},{2,0.03,0,0,0,0},{0,0,2,0.03,0,0},{0,0,0,0,2,0.03},{3,0.06,0,0,0,0},{0,0,3,0.06,0,0},{0,0,0,0,3,0.06},{4,0.1,0,0,0,0},{0,0,4,0.1,0,0},{0,0,0,0,4,0.1},{5,0.15,0,0,0,0},{0,0,5,0.15,0,0},{0,0,0,0,5,0.15},{6,0.21,0,0,0,0},{0,0,6,0.21,0,0},{0,0,0,0,6,0.21},{7,0.28,0,0,0,0},{0,0,7,0.28,0,0},{0,0,0,0,7,0.28},{8,0.36,0,0,0,0},{0,0,8,0.36,0,0},{0,0,0,0,8,0.36},{9,0.45,0,0,0,0},{0,0,9,0.45,0,0},{0,0,0,0,9,0.45},{10,0.55,0,0,0,0},{0,0,10,0.55,0,0},{0,0,0,0,10,0.55},{11,0.66,0,0,0,0},{0,0,11,0.66,0,0},{0,0,0,0,11,0.66},{12,0.78,0,0,0,0},{0,0,12,0.78,0,0},{0,0,0,0,12,0.78},{13,0.91,0,0,0,0},{0,0,13,0.91,0,0},{0,0,0,0,13,0.91},{14,1.05,0,0,0,0},{0,0,14,1.05,0,0},{0,0,0,0,14,1.05},{15,1.2,0,0,0,0},{0,0,15,1.2,0,0},{0,0,0,0,15,1.2},{16,1.36,0,0,0,0},{0,0,16,1.36,0,0},{0,0,0,0,16,1.36},{17,1.53,0,0,0,0},{0,0,17,1.53,0,0},{0,0,0,0,17,1.53},{18,1.71,0,0,0,0},{0,0,18,1.71,0,0},{0,0,0,0,18,1.71},{19,1.9,0,0,0,0},{0,0,19,1.9,0,0},{0,0,0,0,19,1.9},{20,2.1,0,0,0,0},{0,0,20,2.1,0,0},{0,0,0,0,20,2.1},{21,2.31,0,0,0,0},{0,0,21,2.31,0,0},{0,0,0,0,21,2.31},{22,2.53,0,0,0,0},{0,0,22,2.53,0,0},{0,0,0,0,22,2.53},{23,2.76,0,0,0,0},{0,0,23,2.76,0,0},{0,0,0,0,23,2.76},{24,3,0,0,0,0},{0,0,24,3,0,0},{0,0,0,0,24,3},{25,3.25,0,0,0,0},{0,0,25,3.25,0,0},{0,0,0,0,25,3.25},{26,3.51,0,0,0,0},{0,0,26,3.51,0,0},{0,0,0,0,26,3.51},{27,3.78,0,0,0,0},{0,0,27,3.78,0,0},{0,0,0,0,27,3.78},{28,4.06,0,0,0,0},{0,0,28,4.06,0,0},{0,0,0,0,28,4.06},{29,4.35,0,0,0,0},{0,0,29,4.35,0,0},{0,0,0,0,29,4.35},{30,4.65,0,0,0,0},{0,0,30,4.65,0,0},{0,0,0,0,30,4.65}};
	double IqC[90][3] = { {1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1}};
	double WyG[90][3] = {{0.0013863,0,0},{0,0.0010604,0},{0,0,0.0015194},{0.0055452,0,0},{0,0.0042415,0},{0,0,0.0060777},{0.012477,0,0},{0,0.0095435,0},{0,0,0.013675},{0.022181,0,0},{0,0.016966,0},{0,0,0.024311},{0.034658,0,0},{0,0.02651,0},{0,0,0.037985},{0.049907,0,0},{0,0.038174,0},{0,0,0.054699},{0.067929,0,0},{0,0.051959,0},{0,0,0.074451},{0.088723,0,0},{0,0.067865,0},{0,0,0.097242},{0.11229,0,0},{0,0.085891,0},{0,0,0.12307},{0.13863,0,0},{0,0.10604,0},{0,0,0.15194},{0.16774,0,0},{0,0.12831,0},{0,0,0.18385},{0.19963,0,0},{0,0.1527,0},{0,0,0.2188},{0.23428,0,0},{0,0.1792,0},{0,0,0.25678},{0.27172,0,0},{0,0.20784,0},{0,0,0.29781},{0.31192,0,0},{0,0.23859,0},{0,0,0.34187},{0.35489,0,0},{0,0.27146,0},{0,0,0.38897},{0.40064,0,0},{0,0.30645,0},{0,0,0.43911},{0.44916,0,0},{0,0.34356,0},{0,0,0.49229},{0.50045,0,0},{0,0.3828,0},{0,0,0.54851},{0.55452,0,0},{0,0.42415,0},{0,0,0.60777},{0.61136,0,0},{0,0.46763,0},{0,0,0.67006},{0.67097,0,0},{0,0.51323,0},{0,0,0.7354},{0.73335,0,0},{0,0.56094,0},{0,0,0.80377},{0.79851,0,0},{0,0.61078,0},{0,0,0.87518},{0.86644,0,0},{0,0.66274,0},{0,0,0.94963},{0.93714,0,0},{0,0.71682,0},{0,0,1.0271},{1.0106,0,0},{0,0.77302,0},{0,0,1.1077},{1.0869,0,0},{0,0.83134,0},{0,0,1.1912},{1.1659,0,0},{0,0.89178,0},{0,0,1.2778},{1.2477,0,0},{0,0.95435,0},{0,0,1.3675}};
	*/

	// 100 Hz modified with 400 Hz matrices
	double IqTnQ[90][6] = { { 1, 0.0025, 0, 0, 0, 0 }, { 0, 0, 1, 0.0025, 0, 0 }, { 0, 0, 0, 0, 1, 0.0025 }, { 2, 0.0075, 0, 0, 0, 0 }, { 0, 0, 2, 0.0075, 0, 0 }, { 0, 0, 0, 0, 2, 0.0075 }, { 3, 0.015, 0, 0, 0, 0 }, { 0, 0, 3, 0.015, 0, 0 }, { 0, 0, 0, 0, 3, 0.015 }, { 4, 0.025, 0, 0, 0, 0 }, { 0, 0, 4, 0.025, 0, 0 }, { 0, 0, 0, 0, 4, 0.025 }, { 5, 0.0375, 0, 0, 0, 0 }, { 0, 0, 5, 0.0375, 0, 0 }, { 0, 0, 0, 0, 5, 0.0375 }, { 6, 0.0525, 0, 0, 0, 0 }, { 0, 0, 6, 0.0525, 0, 0 }, { 0, 0, 0, 0, 6, 0.0525 }, { 7, 0.07, 0, 0, 0, 0 }, { 0, 0, 7, 0.07, 0, 0 }, { 0, 0, 0, 0, 7, 0.07 }, { 8, 0.09, 0, 0, 0, 0 }, { 0, 0, 8, 0.09, 0, 0 }, { 0, 0, 0, 0, 8, 0.09 }, { 9, 0.1125, 0, 0, 0, 0 }, { 0, 0, 9, 0.1125, 0, 0 }, { 0, 0, 0, 0, 9, 0.1125 }, { 10, 0.1375, 0, 0, 0, 0 }, { 0, 0, 10, 0.1375, 0, 0 }, { 0, 0, 0, 0, 10, 0.1375 }, { 11, 0.165, 0, 0, 0, 0 }, { 0, 0, 11, 0.165, 0, 0 }, { 0, 0, 0, 0, 11, 0.165 }, { 12, 0.195, 0, 0, 0, 0 }, { 0, 0, 12, 0.195, 0, 0 }, { 0, 0, 0, 0, 12, 0.195 }, { 13, 0.2275, 0, 0, 0, 0 }, { 0, 0, 13, 0.2275, 0, 0 }, { 0, 0, 0, 0, 13, 0.2275 }, { 14, 0.2625, 0, 0, 0, 0 }, { 0, 0, 14, 0.2625, 0, 0 }, { 0, 0, 0, 0, 14, 0.2625 }, { 15, 0.3, 0, 0, 0, 0 }, { 0, 0, 15, 0.3, 0, 0 }, { 0, 0, 0, 0, 15, 0.3 }, { 16, 0.34, 0, 0, 0, 0 }, { 0, 0, 16, 0.34, 0, 0 }, { 0, 0, 0, 0, 16, 0.34 }, { 17, 0.3825, 0, 0, 0, 0 }, { 0, 0, 17, 0.3825, 0, 0 }, { 0, 0, 0, 0, 17, 0.3825 }, { 18, 0.4275, 0, 0, 0, 0 }, { 0, 0, 18, 0.4275, 0, 0 }, { 0, 0, 0, 0, 18, 0.4275 }, { 19, 0.475, 0, 0, 0, 0 }, { 0, 0, 19, 0.475, 0, 0 }, { 0, 0, 0, 0, 19, 0.475 }, { 20, 0.525, 0, 0, 0, 0 }, { 0, 0, 20, 0.525, 0, 0 }, { 0, 0, 0, 0, 20, 0.525 }, { 21, 0.5775, 0, 0, 0, 0 }, { 0, 0, 21, 0.5775, 0, 0 }, { 0, 0, 0, 0, 21, 0.5775 }, { 22, 0.6325, 0, 0, 0, 0 }, { 0, 0, 22, 0.6325, 0, 0 }, { 0, 0, 0, 0, 22, 0.6325 }, { 23, 0.69, 0, 0, 0, 0 }, { 0, 0, 23, 0.69, 0, 0 }, { 0, 0, 0, 0, 23, 0.69 }, { 24, 0.75, 0, 0, 0, 0 }, { 0, 0, 24, 0.75, 0, 0 }, { 0, 0, 0, 0, 24, 0.75 }, { 25, 0.8125, 0, 0, 0, 0 }, { 0, 0, 25, 0.8125, 0, 0 }, { 0, 0, 0, 0, 25, 0.8125 }, { 26, 0.8775, 0, 0, 0, 0 }, { 0, 0, 26, 0.8775, 0, 0 }, { 0, 0, 0, 0, 26, 0.8775 }, { 27, 0.945, 0, 0, 0, 0 }, { 0, 0, 27, 0.945, 0, 0 }, { 0, 0, 0, 0, 27, 0.945 }, { 28, 1.015, 0, 0, 0, 0 }, { 0, 0, 28, 1.015, 0, 0 }, { 0, 0, 0, 0, 28, 1.015 }, { 29, 1.0875, 0, 0, 0, 0 }, { 0, 0, 29, 1.0875, 0, 0 }, { 0, 0, 0, 0, 29, 1.0875 }, { 30, 1.1625, 0, 0, 0, 0 }, { 0, 0, 30, 1.1625, 0, 0 }, { 0, 0, 0, 0, 30, 1.1625 } };
	double IqC[90][3] = { { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 }, { 1, 0, 0 }, { 0, 1, 0 }, { 0, 0, 1 } };
	double WyG[90][3] = { { 0.000086644, 0, 0 }, { 0, 0.000066274, 0 }, { 0, 0, 0.000094963 }, { 0.00034658, 0, 0 }, { 0, 0.0002651, 0 }, { 0, 0, 0.00037985 }, { 0.00077979, 0, 0 }, { 0, 0.00059647, 0 }, { 0, 0, 0.00085467 }, { 0.0013863, 0, 0 }, { 0, 0.0010604, 0 }, { 0, 0, 0.0015194 }, { 0.0021661, 0, 0 }, { 0, 0.0016568, 0 }, { 0, 0, 0.0023741 }, { 0.0031192, 0, 0 }, { 0, 0.0023859, 0 }, { 0, 0, 0.0034187 }, { 0.0042455, 0, 0 }, { 0, 0.0032474, 0 }, { 0, 0, 0.0046532 }, { 0.0055452, 0, 0 }, { 0, 0.0042415, 0 }, { 0, 0, 0.0060777 }, { 0.0070182, 0, 0 }, { 0, 0.0053682, 0 }, { 0, 0, 0.007692 }, { 0.0086644, 0, 0 }, { 0, 0.0066274, 0 }, { 0, 0, 0.0094963 }, { 0.010484, 0, 0 }, { 0, 0.0080192, 0 }, { 0, 0, 0.011491 }, { 0.012477, 0, 0 }, { 0, 0.0095435, 0 }, { 0, 0, 0.013675 }, { 0.014643, 0, 0 }, { 0, 0.0112, 0 }, { 0, 0, 0.016049 }, { 0.016982, 0, 0 }, { 0, 0.01299, 0 }, { 0, 0, 0.018613 }, { 0.019495, 0, 0 }, { 0, 0.014912, 0 }, { 0, 0, 0.021367 }, { 0.022181, 0, 0 }, { 0, 0.016966, 0 }, { 0, 0, 0.024311 }, { 0.02504, 0, 0 }, { 0, 0.019153, 0 }, { 0, 0, 0.027444 }, { 0.028073, 0, 0 }, { 0, 0.021473, 0 }, { 0, 0, 0.030768 }, { 0.031278, 0, 0 }, { 0, 0.023925, 0 }, { 0, 0, 0.034282 }, { 0.034658, 0, 0 }, { 0, 0.02651, 0 }, { 0, 0, 0.037985 }, { 0.03821, 0, 0 }, { 0, 0.029227, 0 }, { 0, 0, 0.041879 }, { 0.041936, 0, 0 }, { 0, 0.032077, 0 }, { 0, 0, 0.045962 }, { 0.045835, 0, 0 }, { 0, 0.035059, 0 }, { 0, 0, 0.050236 }, { 0.049907, 0, 0 }, { 0, 0.038174, 0 }, { 0, 0, 0.054699 }, { 0.054152, 0, 0 }, { 0, 0.041421, 0 }, { 0, 0, 0.059352 }, { 0.058571, 0, 0 }, { 0, 0.044801, 0 }, { 0, 0, 0.064195 }, { 0.063163, 0, 0 }, { 0, 0.048314, 0 }, { 0, 0, 0.069228 }, { 0.067929, 0, 0 }, { 0, 0.051959, 0 }, { 0, 0, 0.074451 }, { 0.072867, 0, 0 }, { 0, 0.055736, 0 }, { 0, 0, 0.079864 }, { 0.077979, 0, 0 }, { 0, 0.059647, 0 }, { 0, 0, 0.085467 } };


    /*
    double IqTnQ[90][6] = {{1,0.01,0,0,0,0},{0,0,1,0.01,0,0},{0,0,0,0,1,0.01},{2,0.03,0,0,0,0},{0,0,2,0.03,0,0},{0,0,0,0,2,0.03},{3,0.06,0,0,0,0},{0,0,3,0.06,0,0},{0,0,0,0,3,0.06},{4,0.1,0,0,0,0},{0,0,4,0.1,0,0},{0,0,0,0,4,0.1},{5,0.15,0,0,0,0},{0,0,5,0.15,0,0},{0,0,0,0,5,0.15},{6,0.21,0,0,0,0},{0,0,6,0.21,0,0},{0,0,0,0,6,0.21},{7,0.28,0,0,0,0},{0,0,7,0.28,0,0},{0,0,0,0,7,0.28},{8,0.36,0,0,0,0},{0,0,8,0.36,0,0},{0,0,0,0,8,0.36},{9,0.45,0,0,0,0},{0,0,9,0.45,0,0},{0,0,0,0,9,0.45},{10,0.55,0,0,0,0},{0,0,10,0.55,0,0},{0,0,0,0,10,0.55},{11,0.66,0,0,0,0},{0,0,11,0.66,0,0},{0,0,0,0,11,0.66},{12,0.78,0,0,0,0},{0,0,12,0.78,0,0},{0,0,0,0,12,0.78},{13,0.91,0,0,0,0},{0,0,13,0.91,0,0},{0,0,0,0,13,0.91},{14,1.05,0,0,0,0},{0,0,14,1.05,0,0},{0,0,0,0,14,1.05},{15,1.2,0,0,0,0},{0,0,15,1.2,0,0},{0,0,0,0,15,1.2},{16,1.36,0,0,0,0},{0,0,16,1.36,0,0},{0,0,0,0,16,1.36},{17,1.53,0,0,0,0},{0,0,17,1.53,0,0},{0,0,0,0,17,1.53},{18,1.71,0,0,0,0},{0,0,18,1.71,0,0},{0,0,0,0,18,1.71},{19,1.9,0,0,0,0},{0,0,19,1.9,0,0},{0,0,0,0,19,1.9},{20,2.1,0,0,0,0},{0,0,20,2.1,0,0},{0,0,0,0,20,2.1},{21,2.31,0,0,0,0},{0,0,21,2.31,0,0},{0,0,0,0,21,2.31},{22,2.53,0,0,0,0},{0,0,22,2.53,0,0},{0,0,0,0,22,2.53},{23,2.76,0,0,0,0},{0,0,23,2.76,0,0},{0,0,0,0,23,2.76},{24,3,0,0,0,0},{0,0,24,3,0,0},{0,0,0,0,24,3},{25,3.25,0,0,0,0},{0,0,25,3.25,0,0},{0,0,0,0,25,3.25},{26,3.51,0,0,0,0},{0,0,26,3.51,0,0},{0,0,0,0,26,3.51},{27,3.78,0,0,0,0},{0,0,27,3.78,0,0},{0,0,0,0,27,3.78},{28,4.06,0,0,0,0},{0,0,28,4.06,0,0},{0,0,0,0,28,4.06},{29,4.35,0,0,0,0},{0,0,29,4.35,0,0},{0,0,0,0,29,4.35},{30,4.65,0,0,0,0},{0,0,30,4.65,0,0},{0,0,0,0,30,4.65}};
	double IqC[90][3] = { {1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1},{1,0,0},{0,1,0},{0,0,1}};
	double WyG[90][3] = {{0.00013863,0,0},{0,0.00010604,0},{0,0,0.00015194},{0.00055452,0,0},{0,0.00042415,0},{0,0,0.00060777},{0.0012477,0,0},{0,0.00095435,0},{0,0,0.0013675},{0.0022181,0,0},{0,0.0016966,0},{0,0,0.0024311},{0.0034658,0,0},{0,0.002651,0},{0,0,0.0037985},{0.0049907,0,0},{0,0.0038174,0},{0,0,0.0054699},{0.0067929,0,0},{0,0.0051959,0},{0,0,0.0074451},{0.0088723,0,0},{0,0.0067865,0},{0,0,0.0097242},{0.011229,0,0},{0,0.0085891,0},{0,0,0.012307},{0.013863,0,0},{0,0.010604,0},{0,0,0.015194},{0.016774,0,0},{0,0.012831,0},{0,0,0.018385},{0.019963,0,0},{0,0.01527,0},{0,0,0.02188},{0.023428,0,0},{0,0.01792,0},{0,0,0.025678},{0.027172,0,0},{0,0.020784,0},{0,0,0.029781},{0.031192,0,0},{0,0.023859,0},{0,0,0.034187},{0.035489,0,0},{0,0.027146,0},{0,0,0.038897},{0.040064,0,0},{0,0.030645,0},{0,0,0.043911},{0.044916,0,0},{0,0.034356,0},{0,0,0.049229},{0.050045,0,0},{0,0.03828,0},{0,0,0.054851},{0.055452,0,0},{0,0.042415,0},{0,0,0.060777},{0.061136,0,0},{0,0.046763,0},{0,0,0.067006},{0.067097,0,0},{0,0.051323,0},{0,0,0.07354},{0.073335,0,0},{0,0.056094,0},{0,0,0.080377},{0.079851,0,0},{0,0.061078,0},{0,0,0.087518},{0.086644,0,0},{0,0.066274,0},{0,0,0.094963},{0.093714,0,0},{0,0.071682,0},{0,0,0.10271},{0.10106,0,0},{0,0.077302,0},{0,0,0.11077},{0.10869,0,0},{0,0.083134,0},{0,0,0.11912},{0.11659,0,0},{0,0.089178,0},{0,0,0.12778},{0.12477,0,0},{0,0.095435,0},{0,0,0.13675}};
     */
    double R[90][1];
    double F[90][1];
    double temp1[90][1], temp2[90][1], temp3[1][90], temp4[1][3];

    // Pointer declarations
    double **_f;//     = ptrAlloc(3, 1, f);
	double **_dx;//    = ptrAlloc(6, 1, dx);
	double **_y;//     = ptrAlloc(6, 1, y);
	double **_IqTnQ;// = ptrAlloc(90, 6, IqTnQ);
	double **_IqC;//   = ptrAlloc(90, 3, IqC);
	double **_WyG;//   = ptrAlloc(90, 3, WyG);
	double **_R;//     = ptrAlloc(90, 1, R);
	double **_F;//     = ptrAlloc(90, 1, F);
	double **_temp1;// = ptrAlloc(90, 1, temp1);
	double **_temp2;// = ptrAlloc(90, 1, temp2);
	double **_temp3;// = ptrAlloc(1, 90, temp3);
	double **_temp4;// = ptrAlloc(1, 3, temp4);

	Vector3f            _angle_ef_target;
	double dx1_old;
	double dx3_old;
	double dx5_old;
};

#endif /* AC_ATTITUDE_MPC_H */
